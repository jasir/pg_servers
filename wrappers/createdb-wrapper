#!/bin/bash
# createdb wrapper pro PostgreSQL 16

# Načtení aktuální verze
CURRENT_VERSION="$(cat "/home/jarda/pg_servers/.current_version" 2>/dev/null || echo "16")"

# Získání portu podle verze
get_port() {
    case "$1" in
        9.5) echo "5432" ;;
        9.6) echo "5433" ;;
        12) echo "5434" ;;
        15) echo "5435" ;;
        16) echo "5437" ;;
        *) echo "5432" ;;
    esac
}

PORT=$(get_port "$CURRENT_VERSION")

# Speciální případy pro nástroje které nepotřebují parametry připojení
case "createdb" in
    pg_config)
        docker exec -i "pg${CURRENT_VERSION//./}" pg_config "$@"
        ;;
    pg_isready)
        docker exec -i "pg${CURRENT_VERSION//./}" pg_isready -h localhost -p "$PORT" "$@"
        ;;
    *)
        # Standardní nástroje s připojením k databázi
        docker exec -i "pg${CURRENT_VERSION//./}" createdb -h localhost -p "$PORT" -U postgres "$@"
        ;;
esac
